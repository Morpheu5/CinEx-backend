{"version":3,"file":"EquirectangularPicker.vue_vue_type_script_setup_true_lang-GlrGm7nG.js","sources":["../../../resources/js/components/EquirectangularPicker.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\ntype Props = {\n    src: string | null\n    lat?: number | null\n    lon?: number | null\n    disabled?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n    src: null,\n    lat: null,\n    lon: null,\n    disabled: false,\n})\n\nconst emit = defineEmits<{\n    (e: 'update:lat', value: number): void\n    (e: 'update:lon', value: number): void\n}>()\n\nconst imgEl = ref<HTMLImageElement | null>(null)\n\nfunction clamp(n: number, min: number, max: number) {\n    return Math.min(max, Math.max(min, n))\n}\n\nfunction round(n: number, decimals = 6) {\n    const p = Math.pow(10, decimals)\n    return Math.round(n * p) / p\n}\n\nconst hasPoint = computed(() => Number.isFinite(props.lat) && Number.isFinite(props.lon))\n\n// Convert current lat/lon to marker position in % (for responsive layouts)\nconst markerStyle = computed(() => {\n    if (!hasPoint.value) return null\n\n    // We keep UI in [-90..90] and [-180..180] but compute in a tolerant way.\n    const lat = clamp(Number(props.lat), -90, 90)\n    let lon = Number(props.lon)\n\n    // Wrap lon into [-180,180]\n    lon = ((lon + 180) % 360 + 360) % 360 - 180\n\n    const u = (lon + 180) / 360 // 0..1\n    const v = (90 - lat) / 180  // 0..1\n\n    return {\n        left: `${u * 100}%`,\n        top: `${v * 100}%`,\n    }\n})\n\nfunction onPick(e: MouseEvent) {\n    if (props.disabled) return\n    if (!imgEl.value) return\n    if (!props.src) return\n\n    const rect = imgEl.value.getBoundingClientRect()\n    const x = e.clientX - rect.left\n    const y = e.clientY - rect.top\n\n    const u = clamp(x / rect.width, 0, 1)\n    const v = clamp(y / rect.height, 0, 1)\n\n    const lon = round(u * 360 - 180, 6)    // [-180..180]\n    const lat = round(90 - v * 180, 6)     // [-90..90]\n\n    emit('update:lat', lat)\n    emit('update:lon', lon)\n}\n</script>\n\n<template>\n    <div class=\"space-y-2\">\n        <div class=\"text-sm font-medium\">Pick hotspot coordinates</div>\n\n        <div v-if=\"!src\" class=\"text-sm text-muted-foreground\">\n            Select a photosphere to enable picking.\n        </div>\n\n        <div\n            v-else\n            class=\"relative w-full overflow-hidden rounded-md border bg-black/5\"\n            :class=\"disabled ? 'opacity-60' : ''\"\n        >\n            <!-- The image is the equirectangular panorama shown as a flat preview -->\n            <img\n                ref=\"imgEl\"\n                :src=\"src\"\n                alt=\"Photosphere preview\"\n                class=\"block w-full select-none\"\n                draggable=\"false\"\n                @click=\"onPick\"\n            />\n\n            <!-- Marker -->\n            <div\n                v-if=\"markerStyle\"\n                class=\"absolute -translate-x-1/2 -translate-y-1/2\"\n                :style=\"markerStyle\"\n                aria-hidden=\"true\"\n            >\n                <div class=\"h-4 w-4 rounded-full border-2 border-white bg-black/70 shadow\" />\n            </div>\n\n            <!-- Hint overlay -->\n            <div\n                v-if=\"!disabled\"\n                class=\"pointer-events-none absolute bottom-2 left-2 rounded bg-black/60 px-2 py-1 text-xs text-white\"\n            >\n                Click to set latitude/longitude\n            </div>\n        </div>\n    </div>\n</template>\n"],"names":["props","__props","emit","__emit","imgEl","ref","clamp","n","min","max","round","decimals","p","hasPoint","computed","markerStyle","lat","lon","u","v","onPick","e","rect","x","y","_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","src","_normalizeClass","disabled","_hoisted_4","_hoisted_2"],"mappings":"geAUA,MAAMA,EAAQC,EAORC,EAAOC,EAKPC,EAAQC,EAA6B,IAAI,EAE/C,SAASC,EAAMC,EAAWC,EAAaC,EAAa,CAChD,OAAO,KAAK,IAAIA,EAAK,KAAK,IAAID,EAAKD,CAAC,CAAC,CACzC,CAEA,SAASG,EAAMH,EAAWI,EAAW,EAAG,CACpC,MAAMC,EAAI,KAAK,IAAI,GAAID,CAAQ,EAC/B,OAAO,KAAK,MAAMJ,EAAIK,CAAC,EAAIA,CAC/B,CAEA,MAAMC,EAAWC,EAAS,IAAM,OAAO,SAASd,EAAM,GAAG,GAAK,OAAO,SAASA,EAAM,GAAG,CAAC,EAGlFe,EAAcD,EAAS,IAAM,CAC/B,GAAI,CAACD,EAAS,MAAO,OAAO,KAG5B,MAAMG,EAAMV,EAAM,OAAON,EAAM,GAAG,EAAG,IAAK,EAAE,EAC5C,IAAIiB,EAAM,OAAOjB,EAAM,GAAG,EAG1BiB,IAAQA,EAAM,KAAO,IAAM,KAAO,IAAM,IAExC,MAAMC,GAAKD,EAAM,KAAO,IAClBE,GAAK,GAAKH,GAAO,IAEvB,MAAO,CACH,KAAM,GAAGE,EAAI,GAAG,IAChB,IAAK,GAAGC,EAAI,GAAG,GAAA,CAEvB,CAAC,EAED,SAASC,EAAOC,EAAe,CAG3B,GAFIrB,EAAM,UACN,CAACI,EAAM,OACP,CAACJ,EAAM,IAAK,OAEhB,MAAMsB,EAAOlB,EAAM,MAAM,sBAAA,EACnBmB,EAAIF,EAAE,QAAUC,EAAK,KACrBE,EAAIH,EAAE,QAAUC,EAAK,IAErBJ,EAAIZ,EAAMiB,EAAID,EAAK,MAAO,EAAG,CAAC,EAC9BH,EAAIb,EAAMkB,EAAIF,EAAK,OAAQ,EAAG,CAAC,EAE/BL,EAAMP,EAAMQ,EAAI,IAAM,IAAK,CAAC,EAC5BF,EAAMN,EAAM,GAAKS,EAAI,IAAK,CAAC,EAEjCjB,EAAK,aAAcc,CAAG,EACtBd,EAAK,aAAce,CAAG,CAC1B,eAIIQ,EAAA,EAAAC,EAwCM,MAxCNC,EAwCM,CAvCFC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAA+D,MAAA,CAA1D,MAAM,qBAAA,EAAsB,2BAAwB,EAAA,GAE7CC,EAAAA,SAIZJ,EAgCM,MAAA,OA9BF,MAAKK,EAAA,CAAC,+DACEC,EAAAA,SAAQ,aAAA,EAAA,CAAA,CAAA,GAGhBH,EAOE,MAAA,SANM,QAAJ,IAAIzB,EACH,IAAK0B,EAAAA,IACN,IAAI,sBACJ,MAAM,2BACN,UAAU,QACT,QAAOV,CAAA,YAKFL,EAAA,WADVW,EAOM,MAAA,OALF,MAAM,6CACL,QAAOX,EAAA,KAAW,EACnB,cAAY,MAAA,eAEZc,EAA6E,MAAA,CAAxE,MAAM,+DAAA,EAA+D,KAAA,EAAA,CAAA,gBAKnEG,EAAAA,uBADXN,EAKM,MALNO,EAGC,mCAED,aAnCJP,EAEM,MAFNQ,EAAuD,2CAEvD"}