{"version":3,"file":"_Form.vue_vue_type_script_setup_true_lang-BJc5hqxH.js","sources":["../../../resources/js/pages/admin/navigation-anchor/_Form.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { router } from '@inertiajs/vue3'\nimport { useForm, useField } from 'vee-validate'\nimport { toTypedSchema } from '@vee-validate/zod'\nimport { toast } from 'vue-sonner'\nimport { z } from 'zod'\nimport { computed } from 'vue'\nimport { route } from 'ziggy-js'\n\nimport {\n    FormField,\n    FormItem,\n    FormLabel,\n    FormControl,\n    FormMessage,\n} from '@/components/ui/form'\nimport { Input } from '@/components/ui/input'\nimport { Button } from '@/components/ui/button'\nimport EquirectangularPicker from '@/components/EquirectangularPicker.vue'\n\n/** Props */\nconst props = defineProps<{\n    mode: 'create' | 'edit'\n    photospheres: { id: number; name: string | null }[]\n    initial?: {\n        id?: number\n        photosphere_id?: number | string\n        target_photosphere_id?: number | string\n        name?: string\n        longitude?: number | string\n        latitude?: number | string\n    }\n}>()\n\n/** Zod schema (IDs coerced to numbers; cross-field check at object level) */\nconst schema = z\n    .object({\n        photosphere_id: z.coerce.number().int().positive(),\n        target_photosphere_id: z.coerce.number().int().positive(),\n        name: z.string().min(1).max(191),\n        longitude: z.coerce.number().gte(-180).lte(180),\n        latitude: z.coerce.number().gte(-90).lte(90),\n    })\n    .superRefine((data, ctx) => {\n        if (data.target_photosphere_id === data.photosphere_id) {\n            ctx.addIssue({\n                code: z.ZodIssueCode.custom,\n                path: ['target_photosphere_id'],\n                message: 'Target must be different from source',\n            })\n        }\n    })\n\ntype FormInput = z.infer<typeof schema>\n\n/** Vee-Validate form */\nconst { handleSubmit, setFieldValue } = useForm<FormInput>({\n    validationSchema: toTypedSchema(schema),\n    initialValues: {\n        photosphere_id: String(props.initial?.photosphere_id) ?? '',\n        target_photosphere_id: String(props.initial?.target_photosphere_id) ?? '',\n        name: props.initial?.name ?? '',\n        longitude: props.initial?.longitude ?? '',\n        latitude: props.initial?.latitude ?? '',\n    } as any,\n})\n\n// We want access to current form values to drive the picker preview + marker.\nconst photosphereIdField = useField<string | number>('photosphere_id')\nconst longitudeField = useField<string | number>('longitude')\nconst latitudeField = useField<string | number>('latitude')\n\nconst photosphereImageUrl = computed(() => {\n    const raw = photosphereIdField.value.value\n    const id = Number(raw)\n    if (!Number.isFinite(id) || id <= 0) return null\n    return route('photosphere.image', id)\n})\n\nfunction toNumberOrNull(v: unknown): number | null {\n    if (v === '' || v === null || v === undefined) return null\n    const n = Number(v)\n    return Number.isFinite(n) ? n : null\n}\n\n/** Submit */\nconst onSubmit = handleSubmit((values) => {\n    if (props.mode === 'create') {\n        router.post(route('api.v1.navigation-anchor.store'), values, {\n            preserveScroll: true,\n            onSuccess: () => toast.success('Navigation anchor created'),\n            onError: () => toast.error('Failed to create navigation anchor'),\n        })\n    } else if (props.initial?.id) {\n        router.put(route('api.v1.navigation-anchor.update', props.initial.id), values, {\n            preserveScroll: true,\n            onSuccess: () => toast.success('Navigation anchor updated'),\n            onError: () => toast.error('Failed to update navigation anchor'),\n        })\n    }\n})\n\n/** Optional: quick JSON ingest helper */\nfunction ingestJson(raw: string) {\n    try {\n        const j = JSON.parse(raw);\n        (['photosphere_id','target_photosphere_id','name','longitude','latitude'] as const).forEach((k) => {\n            if (j[k] !== undefined) setFieldValue(k, j[k])\n        })\n        toast.success('Fields populated from JSON')\n    } catch {\n        toast.error('Invalid JSON')\n    }\n}\n</script>\n\n<template>\n    <form class=\"space-y-6\" @submit.prevent=\"onSubmit\">\n        <!-- Name -->\n        <FormField name=\"name\" v-slot=\"{ componentField }\">\n            <FormItem>\n                <FormLabel>Name</FormLabel>\n                <FormControl>\n                    <Input placeholder=\"Anchor label (e.g., North exit)\" v-bind=\"componentField\" />\n                </FormControl>\n                <FormMessage />\n            </FormItem>\n        </FormField>\n\n        <!-- Source Photosphere (native select) -->\n        <FormField name=\"photosphere_id\" v-slot=\"{ value, handleChange, handleBlur }\">\n            <FormItem>\n                <FormLabel>Source Photosphere</FormLabel>\n                <FormControl>\n                    <select\n                        class=\"w-full rounded border px-3 py-2\"\n                        :value=\"value ?? ''\"\n                        @change=\"(e:any) => handleChange(e.target.value)\"\n                        @blur=\"handleBlur\"\n                    >\n                    <option value=\"\" disabled>Select source</option>\n                    <option\n                        v-for=\"p in photospheres\"\n                        :key=\"p.id\"\n                        :value=\"String(p.id)\"\n                    >\n                        {{ p.name ?? `#${p.id}` }}\n                    </option>\n                    </select>\n                </FormControl>\n                <FormMessage />\n            </FormItem>\n        </FormField>\n\n        <!-- Target Photosphere (native select) -->\n        <FormField name=\"target_photosphere_id\" v-slot=\"{ value, handleChange, handleBlur }\">\n            <FormItem>\n                <FormLabel>Target Photosphere</FormLabel>\n                <FormControl>\n                    <select\n                        class=\"w-full rounded border px-3 py-2\"\n                        :value=\"value ?? ''\"\n                        @change=\"(e:any) => handleChange(e.target.value)\"\n                        @blur=\"handleBlur\"\n                    >\n                        <option value=\"\" disabled>Select target</option>\n                        <option\n                            v-for=\"p in photospheres\"\n                            :key=\"p.id\"\n                            :value=\"String(p.id)\"\n                        >\n                            {{ p.name ?? `#${p.id}` }}\n                        </option>\n                    </select>\n                </FormControl>\n                <FormMessage />\n            </FormItem>\n        </FormField>\n\n        <!-- Coordinate picker (uses SOURCE photosphere preview) -->\n        <EquirectangularPicker\n            :src=\"photosphereImageUrl\"\n            :lat=\"toNumberOrNull(latitudeField.value.value)\"\n            :lon=\"toNumberOrNull(longitudeField.value.value)\"\n            @update:lat=\"(v) => setFieldValue('latitude', v)\"\n            @update:lon=\"(v) => setFieldValue('longitude', v)\"\n        />\n\n        <!-- Coordinates -->\n        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <FormField name=\"longitude\" v-slot=\"{ componentField }\">\n                <FormItem>\n                    <FormLabel>Longitude</FormLabel>\n                    <FormControl>\n                        <Input type=\"number\" step=\"0.0000001\" inputmode=\"decimal\" v-bind=\"componentField\" />\n                    </FormControl>\n                    <FormMessage />\n                </FormItem>\n            </FormField>\n\n            <FormField name=\"latitude\" v-slot=\"{ componentField }\">\n                <FormItem>\n                    <FormLabel>Latitude</FormLabel>\n                    <FormControl>\n                        <Input type=\"number\" step=\"0.0000001\" inputmode=\"decimal\" v-bind=\"componentField\" />\n                    </FormControl>\n                    <FormMessage />\n                </FormItem>\n            </FormField>\n        </div>\n\n        <!-- Dev helper -->\n        <details class=\"rounded border p-3\">\n            <summary class=\"cursor-pointer text-sm\">Quick paste JSON (optional)</summary>\n            <div class=\"mt-3 space-y-2\">\n                <p class=\"text-xs text-muted-foreground\">\n                    Accepts: <code>{\"name\",\"longitude\",\"latitude\",\"photosphere_id\",\"target_photosphere_id\"}</code>\n                </p>\n                <textarea\n                    class=\"w-full rounded border p-2 text-sm\"\n                    rows=\"4\"\n                    placeholder='{\"name\":\"North exit\",\"longitude\":11.876,\"latitude\":45.407,\"photosphere_id\":1,\"target_photosphere_id\":2}'\n                    @change=\"(e: any) => { ingestJson(e.target.value); e.target.value = '' }\"\n                />\n            </div>\n        </details>\n\n        <div class=\"flex gap-2\">\n            <Button type=\"submit\">\n                {{ mode === 'create' ? 'Create' : 'Save' }}\n            </Button>\n        </div>\n    </form>\n</template>\n"],"names":["props","__props","schema","z.object","z.coerce","z.string","data","ctx","z.ZodIssueCode","handleSubmit","setFieldValue","useForm","toTypedSchema","photosphereIdField","useField","longitudeField","latitudeField","photosphereImageUrl","computed","raw","id","route","toNumberOrNull","v","n","onSubmit","values","router","toast","ingestJson","j","k","_createElementBlock","_cache","_withModifiers","_unref","args","_createVNode","FormField","_withCtx","componentField","FormItem","FormLabel","FormControl","_mergeProps","FormMessage","value","handleChange","handleBlur","_createElementVNode","e","_Fragment","_renderList","photospheres","p","_toDisplayString","_hoisted_2","_hoisted_4","EquirectangularPicker","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","Button","mode"],"mappings":"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"}