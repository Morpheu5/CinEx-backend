{"version":3,"file":"create-BvzpUq7O.js","sources":["../../../resources/js/pages/admin/gallery/create.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport AppLayout from '@/layouts/AppLayout.vue';\nimport { Head, router } from '@inertiajs/vue3';\nimport { useForm, useField } from 'vee-validate';\nimport { toTypedSchema } from '@vee-validate/zod';\nimport Dropzone from '@/components/Dropzone.vue';\nimport { Button } from '@/components/ui/button';\nimport { toast } from 'vue-sonner';\nimport { computed, reactive } from 'vue';\nimport { route } from 'ziggy-js';\nimport { useObjectUrl } from '@vueuse/core';\nimport type { BreadcrumbItem } from '@/types';\nimport GalleryForm from './_Form.vue';\nimport { galleryCreateSchema, type GalleryCreateSchema } from './_schema';\nimport { FormControl, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\n\nconst props = defineProps<{\n    photospheres: Array<App.Data.PhotosphereData>;\n}>();\n\nconst breadcrumbs: BreadcrumbItem[] = [\n    {\n        title: 'Admin',\n        href: route('admin'),\n    },\n    {\n        title: 'Galleries',\n        href: route('admin.gallery.index'),\n    },\n];\n\nconst { handleSubmit } = useForm<GalleryCreateSchema>({\n    validationSchema: toTypedSchema(galleryCreateSchema),\n});\n\nconst photosphereId = useField<string | undefined>('photosphere_id');\nconst latitudeField = useField<number | undefined>('latitude');\nconst longitudeField = useField<number | undefined>('longitude');\n\nconst pendingFiles = reactive<File[]>([]);\n\nconst photosphereImageUrl = computed(() => {\n    const raw = photosphereId.value.value;\n    const id = raw ? Number(raw) : null;\n    if (!id) return null;\n    return route('photosphere.image', id);\n});\n\nfunction setLatLon(lat: number, lon: number) {\n    latitudeField.setValue(lat);\n    longitudeField.setValue(lon);\n}\n\nfunction addFiles(files: File[]) {\n    for (const f of files) if (f.type.startsWith('image/')) pendingFiles.push(f);\n}\nfunction removePending(idx: number) {\n    pendingFiles.splice(idx, 1);\n}\n\nconst submit = handleSubmit((vals) => {\n    const fd = new FormData();\n    fd.append('photosphere_id', String(vals.photosphere_id));\n    fd.append('name', vals.name);\n    if (vals.latitude !== undefined) fd.append('latitude', String(vals.latitude));\n    if (vals.longitude !== undefined) fd.append('longitude', String(vals.longitude));\n    pendingFiles.forEach((f, i) => fd.append(`photos[${i}]`, f));\n\n    router.post(route('api.v1.gallery.store'), fd, {\n        forceFormData: true,\n        onSuccess: () => toast.success('Gallery created'),\n        onError: () => toast.error('Validation failed'),\n    });\n});\n</script>\n\n<template>\n    <Head title=\"Create Gallery\" />\n\n    <AppLayout :breadcrumbs=\"breadcrumbs\">\n        <div class=\"p-4\">\n            <div class=\"py-3\">\n                <h1 class=\"mr-3 inline py-3 text-xl\">New gallery</h1>\n            </div>\n\n            <form class=\"mt-4 max-w-3xl space-y-6\" @submit.prevent=\"submit\">\n                <GalleryForm\n                    :picker-src=\"photosphereImageUrl\"\n                    :lat=\"latitudeField.value.value ?? null\"\n                    :lon=\"longitudeField.value.value ?? null\"\n                    @update:lat=\"(v) => latitudeField.setValue(v)\"\n                    @update:lon=\"(v) => longitudeField.setValue(v)\"\n                >\n                    <template #before>\n                        <FormField name=\"photosphere_id\" v-slot=\"{ value, handleChange, errorMessage }\">\n                            <FormItem>\n                                <FormLabel>Photosphere</FormLabel>\n                                <FormControl>\n                                    <select\n                                        class=\"w-full rounded-md border p-2\"\n                                        :value=\"value ?? ''\"\n                                        @change=\"handleChange(($event.target as HTMLSelectElement).value)\"\n                                    >\n                                        <option value=\"\">Selectâ€¦</option>\n                                        <option v-for=\"p in props.photospheres\" :key=\"p.id\" :value=\"String(p.id)\">\n                                            {{ p.name }}\n                                        </option>\n                                    </select>\n                                </FormControl>\n                                <FormMessage>{{ errorMessage }}</FormMessage>\n                            </FormItem>\n                        </FormField>\n                    </template>\n                </GalleryForm>\n\n                <!-- Photos -->\n                <div class=\"space-y-3\">\n                    <!-- Use a plain heading or the standalone Label component instead of FormLabel -->\n                    <div class=\"text-sm font-medium\">Photos</div>\n                    <Dropzone multiple accept=\"image/*\" @files=\"addFiles\" />\n                    <div v-if=\"pendingFiles.length\" class=\"grid grid-cols-2 gap-3 md:grid-cols-4\">\n                        <div v-for=\"(f, idx) in pendingFiles\" :key=\"idx\" class=\"space-y-2 rounded border p-2\">\n                            <img :src=\"useObjectUrl(f).value\" alt=\"\" class=\"aspect-square w-full rounded object-cover\" />\n                            <Button type=\"button\" variant=\"destructive\" class=\"w-full\" @click=\"removePending(idx)\"> Remove </Button>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"pt-2\">\n                    <Button type=\"submit\">Create gallery</Button>\n                </div>\n            </form>\n        </div>\n    </AppLayout>\n</template>\n"],"names":["props","__props","breadcrumbs","route","handleSubmit","useForm","toTypedSchema","galleryCreateSchema","photosphereId","useField","latitudeField","longitudeField","pendingFiles","reactive","photosphereImageUrl","computed","raw","id","addFiles","files","f","removePending","idx","submit","vals","fd","i","router","toast","_createVNode","_unref","Head","AppLayout","_createElementVNode","_hoisted_1","_cache","_withModifiers","args","GalleryForm","v","_component_FormField","_withCtx","value","handleChange","errorMessage","FormItem","FormLabel","FormControl","$event","_openBlock","_createElementBlock","_Fragment","_renderList","p","_toDisplayString","_hoisted_3","FormMessage","_hoisted_4","Dropzone","_hoisted_5","useObjectUrl","Button","_hoisted_7"],"mappings":"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"}