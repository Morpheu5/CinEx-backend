import{d as A,f as Z,s as F,g as T,c as p,o as m,j as z,a as o,b as n,u as t,w as l,e as u,z as y,F as I,k as J,t as x}from"./app-MbwmxENq.js";import{u as D,a as C,F as _,_ as f,b as g,c as h,d as c}from"./FormMessage.vue_vue_type_script_setup_true_lang-B81r2i96.js";import{o as M,c as v,s as Q,Z as R,t as q}from"./vee-validate-zod-C-Y2Lq6T.js";import{t as d}from"./index-BxdJrSRa.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang-mF2s47O3.js";import{_ as G}from"./index-CHp6LXy2.js";import{_ as H}from"./EquirectangularPicker.vue_vue_type_script_setup_true_lang-GlrGm7nG.js";const K=["value","onChange","onBlur"],W=["value"],X=["value","onChange","onBlur"],Y=["value"],ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"rounded border p-3"},oe={class:"mt-3 space-y-2"},ae={class:"flex gap-2"},pe=A({__name:"_Form",props:{mode:{},photospheres:{},initial:{}},setup(O){const i=O,V=M({photosphere_id:v.number().int().positive(),target_photosphere_id:v.number().int().positive(),name:Q().min(1).max(191),longitude:v.number().gte(-180).lte(180),latitude:v.number().gte(-90).lte(90)}).superRefine((r,e)=>{r.target_photosphere_id===r.photosphere_id&&e.addIssue({code:R.custom,path:["target_photosphere_id"],message:"Target must be different from source"})}),{handleSubmit:k,setFieldValue:b}=D({validationSchema:q(V),initialValues:{photosphere_id:String(i.initial?.photosphere_id)??"",target_photosphere_id:String(i.initial?.target_photosphere_id)??"",name:i.initial?.name??"",longitude:i.initial?.longitude??"",latitude:i.initial?.latitude??""}}),E=C("photosphere_id"),j=C("longitude"),L=C("latitude"),P=Z(()=>{const r=E.value.value,e=Number(r);return!Number.isFinite(e)||e<=0?null:F("photosphere.image",e)});function w(r){if(r===""||r===null||r===void 0)return null;const e=Number(r);return Number.isFinite(e)?e:null}const B=k(r=>{i.mode==="create"?T.post(F("api.v1.navigation-anchor.store"),r,{preserveScroll:!0,onSuccess:()=>d.success("Navigation anchor created"),onError:()=>d.error("Failed to create navigation anchor")}):i.initial?.id&&T.put(F("api.v1.navigation-anchor.update",i.initial.id),r,{preserveScroll:!0,onSuccess:()=>d.success("Navigation anchor updated"),onError:()=>d.error("Failed to update navigation anchor")})});function U(r){try{const e=JSON.parse(r);["photosphere_id","target_photosphere_id","name","longitude","latitude"].forEach(a=>{e[a]!==void 0&&b(a,e[a])}),d.success("Fields populated from JSON")}catch{d.error("Invalid JSON")}}return(r,e)=>(m(),p("form",{class:"space-y-6",onSubmit:e[3]||(e[3]=z((...a)=>t(B)&&t(B)(...a),["prevent"]))},[o(t(_),{name:"name"},{default:l(({componentField:a})=>[o(t(f),null,{default:l(()=>[o(t(g),null,{default:l(()=>e[4]||(e[4]=[u("Name",-1)])),_:1,__:[4]}),o(t(h),null,{default:l(()=>[o(t($),y({placeholder:"Anchor label (e.g., North exit)"},a),null,16)]),_:2},1024),o(t(c))]),_:2},1024)]),_:1}),o(t(_),{name:"photosphere_id"},{default:l(({value:a,handleChange:S,handleBlur:N})=>[o(t(f),null,{default:l(()=>[o(t(g),null,{default:l(()=>e[5]||(e[5]=[u("Source Photosphere",-1)])),_:1,__:[5]}),o(t(h),null,{default:l(()=>[n("select",{class:"w-full rounded border px-3 py-2",value:a??"",onChange:s=>S(s.target.value),onBlur:N},[e[6]||(e[6]=n("option",{value:"",disabled:""},"Select source",-1)),(m(!0),p(I,null,J(r.photospheres,s=>(m(),p("option",{key:s.id,value:String(s.id)},x(s.name??`#${s.id}`),9,W))),128))],40,K)]),_:2},1024),o(t(c))]),_:2},1024)]),_:1}),o(t(_),{name:"target_photosphere_id"},{default:l(({value:a,handleChange:S,handleBlur:N})=>[o(t(f),null,{default:l(()=>[o(t(g),null,{default:l(()=>e[7]||(e[7]=[u("Target Photosphere",-1)])),_:1,__:[7]}),o(t(h),null,{default:l(()=>[n("select",{class:"w-full rounded border px-3 py-2",value:a??"",onChange:s=>S(s.target.value),onBlur:N},[e[8]||(e[8]=n("option",{value:"",disabled:""},"Select target",-1)),(m(!0),p(I,null,J(r.photospheres,s=>(m(),p("option",{key:s.id,value:String(s.id)},x(s.name??`#${s.id}`),9,Y))),128))],40,X)]),_:2},1024),o(t(c))]),_:2},1024)]),_:1}),o(H,{src:P.value,lat:w(t(L).value.value),lon:w(t(j).value.value),"onUpdate:lat":e[0]||(e[0]=a=>t(b)("latitude",a)),"onUpdate:lon":e[1]||(e[1]=a=>t(b)("longitude",a))},null,8,["src","lat","lon"]),n("div",ee,[o(t(_),{name:"longitude"},{default:l(({componentField:a})=>[o(t(f),null,{default:l(()=>[o(t(g),null,{default:l(()=>e[9]||(e[9]=[u("Longitude",-1)])),_:1,__:[9]}),o(t(h),null,{default:l(()=>[o(t($),y({type:"number",step:"0.0000001",inputmode:"decimal"},a),null,16)]),_:2},1024),o(t(c))]),_:2},1024)]),_:1}),o(t(_),{name:"latitude"},{default:l(({componentField:a})=>[o(t(f),null,{default:l(()=>[o(t(g),null,{default:l(()=>e[10]||(e[10]=[u("Latitude",-1)])),_:1,__:[10]}),o(t(h),null,{default:l(()=>[o(t($),y({type:"number",step:"0.0000001",inputmode:"decimal"},a),null,16)]),_:2},1024),o(t(c))]),_:2},1024)]),_:1})]),n("details",te,[e[12]||(e[12]=n("summary",{class:"cursor-pointer text-sm"},"Quick paste JSON (optional)",-1)),n("div",oe,[e[11]||(e[11]=n("p",{class:"text-xs text-muted-foreground"},[u(" Accepts: "),n("code",null,'{"name","longitude","latitude","photosphere_id","target_photosphere_id"}')],-1)),n("textarea",{class:"w-full rounded border p-2 text-sm",rows:"4",placeholder:'{"name":"North exit","longitude":11.876,"latitude":45.407,"photosphere_id":1,"target_photosphere_id":2}',onChange:e[2]||(e[2]=a=>{U(a.target.value),a.target.value=""})},null,32)])]),n("div",ae,[o(t(G),{type:"submit"},{default:l(()=>[u(x(r.mode==="create"?"Create":"Save"),1)]),_:1})])],32))}});export{pe as _};
//# sourceMappingURL=_Form.vue_vue_type_script_setup_true_lang-BJc5hqxH.js.map
