import{d as Q,C as U,g as L,s as V,i as W,c as x,o as p,j as X,a as t,n as j,b as f,u as e,w as a,e as s,F as q,k as B,z as g,t as m,m as Y,D as Z}from"./app-MbwmxENq.js";import{u as ee,e as te,F as y,_ as c,b as h,c as b,d as v}from"./FormMessage.vue_vue_type_script_setup_true_lang-B81r2i96.js";import{_ as w}from"./Input.vue_vue_type_script_setup_true_lang-mF2s47O3.js";import{_ as k}from"./index-CHp6LXy2.js";import{t as S}from"./index-BxdJrSRa.js";import{p as F,c as $,o as D,s as C,n as ae,a as le,i as re,t as se}from"./vee-validate-zod-C-Y2Lq6T.js";const oe=["value"],ne=["value"],ie={class:"break-all py-1"},de={class:"mt-6 border-t pt-4"},ue={class:"mb-2 flex items-center justify-between"},fe={key:0,class:"mb-2 text-sm text-muted-foreground"},me={class:"flex justify-end"},pe={class:"flex flex-row py-3"},xe=Q({__name:"_Form",props:{mode:{},theatres:{},photosphere:{}},setup(R){const d=R;function T(r){if(!r)return[];if(Array.isArray(r))return r.map(u=>({id:u?.id,name:u?.name??"",latitude:u?.latitude,longitude:u?.longitude})).filter(u=>u.name!==""||Number.isFinite(u.latitude)||Number.isFinite(u.longitude));const l=r;return Array.isArray(l.data)?T(l.data):[]}const E=F(r=>r===""||r===null?void 0:r,$.number().min(-90).max(90)),O=F(r=>r===""||r===null?void 0:r,$.number().min(-180).max(180)),z=D({id:ae().int().positive().optional(),name:C().min(1,"Name is required"),latitude:E,longitude:O}),J=D({theatre_id:F(r=>r===""||r===null?void 0:r,$.number({invalid_type_error:"Please select a theatre"}).int().positive("Please select a theatre")),name:C().min(1,"Name is required"),path:C().nullable().optional(),file:re(File).nullable().optional(),galleries:le(z).default([])}),{handleSubmit:M,setFieldValue:A,values:N}=ee({validationSchema:se(J),initialValues:{theatre_id:d.photosphere?.theatre_id??"",name:d.photosphere?.name??"",path:d.mode==="edit"?d.photosphere?.path??null:null,file:null,galleries:d.mode==="edit"?T(d.photosphere?.galleries):[]}}),{fields:G,push:H,remove:I}=te("galleries");U(()=>d.theatres,r=>{d.mode==="create"&&Array.isArray(r)&&r.length===1&&A("theatre_id",String(r[0].id))},{immediate:!0});const P=M(r=>{if(d.mode==="create"){L.post(V("api.v1.photosphere.store"),r,{forceFormData:!0,preserveScroll:!0,preserveState:!1,onError:l=>S.error(JSON.stringify(l)),onSuccess:()=>S.success("Photosphere created!")});return}if(!d.photosphere?.id){S.error("Missing photosphere id");return}L.post(V("api.v1.photosphere.update",d.photosphere.id),{...r,_method:"put"},{forceFormData:!0,preserveScroll:!0,preserveState:!1,onError:l=>S.error(JSON.stringify(l)),onSuccess:()=>S.success("Photosphere updated!")})}),K=async()=>{A("path",""),await Z()};return(r,l)=>{const u=W("fa");return p(),x("form",{onSubmit:l[1]||(l[1]=X((...n)=>e(P)&&e(P)(...n),["prevent"]))},[t(e(y),{name:"theatre_id"},{default:a(({field:n,errorMessage:o})=>[t(e(c),{class:"flex flex-row py-3"},{default:a(()=>[t(e(h),{class:"w-24",id:"theatre_id"},{default:a(()=>l[2]||(l[2]=[s("Theatre",-1)])),_:1,__:[2]}),t(e(b),null,{default:a(()=>[f("select",g(n,{value:e(N).theatre_id,"aria-labelledby":"theatre_id",class:"mt-1 block w-full rounded border p-2"}),[l[3]||(l[3]=f("option",{value:"",disabled:""},"Select a theatre...",-1)),(p(!0),x(q,null,B(r.theatres,i=>(p(),x("option",{key:i.id,value:i.id},m(i.name),9,ne))),128))],16,oe)]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(o),1)]),_:2},1024)]),_:2},1024)]),_:1}),t(e(y),{name:"name"},{default:a(({field:n,errorMessage:o})=>[t(e(c),{class:"flex flex-row py-3"},{default:a(()=>[t(e(h),{class:"w-24",id:"name"},{default:a(()=>l[4]||(l[4]=[s("Name",-1)])),_:1,__:[4]}),t(e(b),null,{default:a(()=>[t(e(w),g({type:"text"},n,{"aria-labelledby":"name"}),null,16)]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(o),1)]),_:2},1024)]),_:2},1024)]),_:1}),r.mode==="create"||!e(N).path?(p(),j(e(y),{key:"file",name:"file"},{default:a(({handleChange:n,errorMessage:o})=>[t(e(c),{class:"flex flex-row py-3"},{default:a(()=>[t(e(h),{class:"w-24",id:"file"},{default:a(()=>l[5]||(l[5]=[s("File",-1)])),_:1,__:[5]}),t(e(b),null,{default:a(()=>[t(e(w),{type:"file",onChange:i=>{const _=i.target.files?.[0]??null;n(_)},"aria-labelledby":"file"},null,8,["onChange"])]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(o),1)]),_:2},1024)]),_:2},1024)]),_:1})):(p(),j(e(y),{key:"path",name:"path"},{default:a(({field:n,errorMessage:o})=>[t(e(c),{class:"flex flex-row py-3"},{default:a(()=>[t(e(h),{class:"w-24",id:"path"},{default:a(()=>l[6]||(l[6]=[s("Path",-1)])),_:1,__:[6]}),t(e(b),{class:"flex items-center gap-3"},{default:a(()=>[t(e(k),{type:"button",onClick:K,variant:"destructive"},{default:a(()=>[t(u,{icon:"fa-solid fa-trash-can"})]),_:1}),f("span",ie,m(e(N).path),1),f("input",g(n,{type:"hidden"}),null,16)]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(o),1)]),_:2},1024)]),_:2},1024)]),_:1})),f("div",de,[f("div",ue,[l[8]||(l[8]=f("h2",{class:"text-lg font-semibold"},"Galleries",-1)),t(e(k),{type:"button",variant:"secondary",onClick:l[0]||(l[0]=n=>e(H)({name:"",latitude:NaN,longitude:NaN}))},{default:a(()=>l[7]||(l[7]=[s(" + Add gallery ",-1)])),_:1,__:[7]})]),e(G).length===0?(p(),x("div",fe," No galleries yet. Add one. ")):Y("",!0),(p(!0),x(q,null,B(e(G),(n,o)=>(p(),x("div",{key:n.key,class:"mb-3 rounded-lg border p-3"},[t(e(y),{name:`galleries.${o}.name`},{default:a(({componentField:i,errorMessage:_})=>[t(e(c),{class:"flex flex-row py-2"},{default:a(()=>[t(e(h),{class:"w-24"},{default:a(()=>l[9]||(l[9]=[s("Name",-1)])),_:1,__:[9]}),t(e(b),{class:"flex-1"},{default:a(()=>[t(e(w),g({type:"text","aria-label":`Gallery ${o+1} name`},{ref_for:!0},i),null,16,["aria-label"])]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(_),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["name"]),t(e(y),{name:`galleries.${o}.latitude`},{default:a(({componentField:i,errorMessage:_})=>[t(e(c),{class:"flex flex-row py-2"},{default:a(()=>[t(e(h),{class:"w-24"},{default:a(()=>l[10]||(l[10]=[s("Latitude",-1)])),_:1,__:[10]}),t(e(b),{class:"flex-1"},{default:a(()=>[t(e(w),g({type:"number",step:"any",inputmode:"decimal","aria-label":`Gallery ${o+1} latitude`},{ref_for:!0},i),null,16,["aria-label"])]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(_),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["name"]),t(e(y),{name:`galleries.${o}.longitude`},{default:a(({componentField:i,errorMessage:_})=>[t(e(c),{class:"flex flex-row py-2"},{default:a(()=>[t(e(h),{class:"w-24"},{default:a(()=>l[11]||(l[11]=[s("Longitude",-1)])),_:1,__:[11]}),t(e(b),{class:"flex-1"},{default:a(()=>[t(e(w),g({type:"number",step:"any",inputmode:"decimal","aria-label":`Gallery ${o+1} longitude`},{ref_for:!0},i),null,16,["aria-label"])]),_:2},1024),t(e(v),null,{default:a(()=>[s(m(_),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["name"]),f("div",me,[t(e(k),{type:"button",variant:"destructive",onClick:i=>e(I)(o)},{default:a(()=>l[12]||(l[12]=[s("Remove",-1)])),_:2,__:[12]},1032,["onClick"])])]))),128))]),f("div",pe,[l[14]||(l[14]=f("div",{class:"spacer"},null,-1)),t(e(k),{type:"submit",variant:"default"},{default:a(()=>l[13]||(l[13]=[s("Save",-1)])),_:1,__:[13]})])],32)}}});export{xe as _};
//# sourceMappingURL=_Form.vue_vue_type_script_setup_true_lang-B76KZkqy.js.map
