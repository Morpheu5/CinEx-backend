import{d as P,s as a,f as B,r as N,g as u,n as c,o as d,w as v,a as m,b as i,u as s,h as U,j as G,c as f,m as R,F as _,k as S,e as T}from"./app-MbwmxENq.js";import{_ as A,a as j}from"./_schema-D0fQBxrP.js";import{_ as I}from"./index-CHp6LXy2.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-ChnGhnGT.js";import{t as L}from"./vee-validate-zod-C-Y2Lq6T.js";import{u as M,a as b}from"./FormMessage.vue_vue_type_script_setup_true_lang-B81r2i96.js";import{t as p}from"./index-BxdJrSRa.js";import{_ as x}from"./FileThumb.vue_vue_type_script_setup_true_lang-Cm1jj02J.js";import{_ as O}from"./_Form.vue_vue_type_script_setup_true_lang-B8oKrote.js";import"./Primitive-mDfYgi-U.js";import"./index-oP4qFRLE.js";import"./VisuallyHidden-CBhFKQtd.js";import"./index-DQ1F4Mgb.js";import"./index-CHXQtOYb.js";import"./useId-BA1mJUwU.js";import"./Label.vue_vue_type_script_setup_true_lang-BMql7QJ1.js";import"./Input.vue_vue_type_script_setup_true_lang-mF2s47O3.js";import"./EquirectangularPicker.vue_vue_type_script_setup_true_lang-GlrGm7nG.js";const W={class:"space-y-3"},q={key:0,class:"grid grid-cols-2 gap-3 md:grid-cols-5"},z={class:"mt-10 px-4"},H={class:"grid grid-cols-2 gap-3 md:grid-cols-4 lg:grid-cols-5"},K={class:"px-4 pb-8 pt-6"},ge=P({__name:"edit",props:{gallery:{},photospheres:{}},setup(F){const r=F,$=[{title:"Admin",href:a("admin")},{title:"Galleries",href:a("admin.gallery.index")},{title:`${r.gallery.name} (photosphere: ${r.gallery.photosphere?.name})`,href:a("admin.gallery.show",r.gallery.id)}],{handleSubmit:k}=M({validationSchema:L(j),initialValues:{name:r.gallery.name,latitude:r.gallery.latitude??void 0,longitude:r.gallery.longitude??void 0}}),g=b("latitude"),h=b("longitude"),w=B(()=>{const t=r.gallery?.photosphere?.id??r.gallery?.photosphere_id;return t?a("photosphere.image",t):null}),n=N([]);function D(t){for(const e of t)e.type.startsWith("image/")&&n.push(e)}function E(t){n.splice(t,1)}const y=k(t=>{const e=new FormData;e.append("name",t.name),t.latitude!==void 0&&e.append("latitude",String(t.latitude)),t.longitude!==void 0&&e.append("longitude",String(t.longitude)),n.forEach((o,l)=>e.append(`photos[${l}]`,o)),e.append("_method","PUT"),u.post(a("api.v1.gallery.update",r.gallery.id),e,{forceFormData:!0,preserveState:!1,preserveScroll:!0,onSuccess:()=>{n.splice(0),p.success("Gallery updated")},onError:o=>p.error("Update failed<br />"+JSON.stringify(o))})});function V(t,e){u.put(a("api.v1.photo.update",{photo:t,description:e}),{description:e},{onSuccess:()=>p.success("Description saved"),onError:()=>p.error("Could not save description"),preserveScroll:!0,preserveState:!0})}function C(t){confirm("This action cannot be undone. Are you sure you want to proceed?")&&u.delete(a("api.v1.photo.destroy",{photo:t}),{onSuccess:()=>p.success("Photo removed"),onError:()=>p.error("Delete failed")})}return(t,e)=>(d(),c(J,{breadcrumbs:$},{default:v(()=>[m(s(U),{title:`Edit Gallery â€” ${r.gallery.name}`},null,8,["title"]),e[6]||(e[6]=i("div",{class:"p-4"},[i("h1",{class:"mr-3 inline py-3 text-xl"},"Gallery editor")],-1)),i("form",{id:"gallery-edit-form",class:"ml-4 max-w-4xl space-y-6",onSubmit:e[2]||(e[2]=G((...o)=>s(y)&&s(y)(...o),["prevent"]))},[m(O,{"picker-src":w.value,lat:s(g).value.value??null,lon:s(h).value.value??null,"onUpdate:lat":e[0]||(e[0]=o=>s(g).setValue(o)),"onUpdate:lon":e[1]||(e[1]=o=>s(h).setValue(o))},null,8,["picker-src","lat","lon"]),i("div",W,[e[3]||(e[3]=i("label",null,"Add Photos",-1)),m(A,{multiple:"",accept:"image/*",onFiles:D}),n.length?(d(),f("div",q,[(d(!0),f(_,null,S(n,(o,l)=>(d(),c(x,{key:l,file:o,onRemove:Q=>E(l)},null,8,["file","onRemove"]))),128))])):R("",!0)])],32),i("div",z,[e[4]||(e[4]=i("h2",{class:"mb-3 text-lg font-semibold"},"Existing Photos",-1)),i("div",H,[(d(!0),f(_,null,S(r.gallery.photos,o=>(d(),c(x,{key:o.id,photo:o,"show-description":"",onDescriptionChange:l=>V(o,l),onRemove:l=>C(o.id),editable:""},null,8,["photo","onDescriptionChange","onRemove"]))),128))])]),i("div",K,[m(s(I),{type:"submit",form:"gallery-edit-form"},{default:v(()=>e[5]||(e[5]=[T("Save",-1)])),_:1,__:[5]})])]),_:1,__:[6]}))}});export{ge as default};
//# sourceMappingURL=edit-CbIyaUwC.js.map
